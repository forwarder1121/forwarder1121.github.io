# USER ê¸°ëŠ¥



íšŒì› ê´€ë ¨ ê¸°ëŠ¥ì€ í¬ê²Œ íšŒì›ê°€ì…ì„ ì˜ë¯¸í•˜ëŠ” **JOINê³¼ LOGIN** ìœ¼ë¡œ ì´ë£¨ì–´ì ¸ ìˆë‹¤

ì‚¬ìš©ìê°€ ë¨¼ì € íšŒì›ê°€ì…ì„ í•  ìˆ˜ ìˆê²Œ í•œ ë’¤ì—, ê·¸ ê³„ì •ìœ¼ë¡œ ë¡œê·¸ì¸ì„ í•  ìˆ˜ ìˆê²Œ í•˜ëŠ” ìˆœì„œë¡œ ì•Œì•„ë³´ë„ë¡ í•˜ì.



## Join



íšŒì›ê°€ì… ê¸°ëŠ¥ì„ ìœ„í•œ ìˆœì„œëŠ” ì•„ë˜ì™€ ê°™ë‹¤.

1. User ëª¨ë¸ ì œì‘
2. ë¼ìš°íŒ… ì²˜ë¦¬
3. Form ì œì‘
4. ì»¨íŠ¸ë¡¤ëŸ¬ ì²˜ë¦¬



### User ëª¨ë¸

ê° íšŒì›ì´ ê°€ì§€ê³  ìˆì–´ì•¼ ì •ë³´ë“¤ì„ userSchemaì— ì •ì˜í•˜ê³ , ì´ë¥¼ User ëª¨ë¸ë¡œ ë§Œë“ ë‹¤.

ì´ë•Œ íšŒì›ì´ ê°€ì§€ê³  ìˆëŠ” emailê³¼ usernameì€ ìœ ì¼í•´ì•¼ í•˜ë¯€ë¡œ unique : true ì†ì„±ì„ ë¶€ì—¬í•œë‹¤.

```js
import mongoose from "mongoose";
import bcrypt from "bcrypt";

const userSchema = new mongoose.Schema({
  email: { type: String, required: true, unique: true },
  username: { type: String, required: true, unique: true },
  password: { type: String, required: true },
  name: { type: String, required: true },
  location: String,
});

const User = mongoose.model("User", userSchema);
export default User;
```

ë¬¼ë¡  ëª¨ë¸ì„ ì œì‘í•œ ë’¤, ì„œë²„ì˜ ì´ˆê¸°í™”ë¥¼ ë‹´ë‹¹í•˜ëŠ” íŒŒì¼ì—ì„œëŠ” ì´ ëª¨ë¸ì„ import ì‹œì¼œì£¼ì–´ì•¼ í•œë‹¤.

```js
import "./db";
import "./models/Video";
import "./models/User";
import app from "./server";
const PORT = 4000;
const handleListening = () =>
  console.log(`ğŸš€ Server listening on port http://localhost:${PORT}`);

app.listen(4000, handleListening);
```



### Routing

localhost:4000/joinì˜ URLë¡œ ì ‘ì†í•  ë•Œ ì•Œë§ì€ ì‘ë‹µì„ ë°›ê¸° ìœ„í•´ ë¼ìš°íŒ… ì²˜ë¦¬ë¥¼ í•´ì¤€ë‹¤.

```js
import express from "express";
import {
    getJoin,
    postJoin,
    getLogin,
    postLogin,
} from "../controllers/userController";
import { home, search } from "../controllers/videoController";
const rootRouter = express.Router();

rootRouter.get("/", home);
rootRouter.route("/join").get(getJoin).post(postJoin);
rootRouter.route("/login").get(getLogin).post(postLogin);
rootRouter.get("/login", getLogin);
rootRouter.get("/search", search);

export default rootRouter;
```

ì—¬ê¸°ì„œ ì»¨íŠ¸ë¡¤ëŸ¬ëŠ” ì„ì‹œë¡œ ê°„ë‹¨í•œ ë¬¸ìì—´ì„ ì¶œë ¥í•˜ëŠ” ìˆ˜ì¤€ìœ¼ë¡œ ë§Œë“¤ì–´ ë†“ê³ , ì¶”í›„ ì„¸ë¶€ì ì¸ ì„¸íŒ…ì„ í•˜ì.



### Making Form 

```pug
extends base

block content
    if errorMessage
        span=errorMessage

    form(method="POST")
        input(placeholder="Name" name="name", type="text",required)
        input(placeholder="Email" name="email",type="email",required)
        input(placeholder="Username" name="username",type="text",required)
        input(placeholder="Password" name="password",type="password",required)
        input(placeholder="Confirm Password" name="password2",type="password",required)
        input(placeholder="Location" name="location",type="text")
        input(type="submit",value="Join")
    hr
    div 
        span Already have an account?  
        a(href="/login") Login in now &rarr;
```

Formì„ ì‘ì„± ì™„ë£Œí•œ ë’¤ì— Join ë²„íŠ¼ì„ ëˆ„ë¥´ë©´ í˜„ì¬ í˜ì´ì§€ URLì—ì„œ POST ìš”ì²­ì„ ë³´ë‚¸ë‹¤.

ë˜í•œ Formì— ì‘ì„±ëœ ë°ì´í„°ë“¤ì€ req.bodyë¥¼ ì´ìš©í•˜ì—¬ ì ‘ê·¼í•  ìˆ˜ ìˆë‹¤.



### Controlling

ìœ„ì˜ Formì—ì„œ ë³´ë‚¸ ë°ì´í„°ë“¤ì„ ì»¨íŠ¸ë¡¤ëŸ¬ì—ì„œ ë°›ì•„ì„œ ê³„ì •ì„ ìƒì„±í•˜ê³ , ì´ë¥¼ DBì— ì €ì¥í•œë‹¤.

ì´ë•Œ ì£¼ì˜í•´ì•¼ í•  ì ì´ ëª‡ê°€ì§€ ìˆë‹¤.

ë¨¼ì €, ì‚¬ìš©ìê°€ ì…ë ¥í•œ Formì˜ ë¹„ë°€ë²ˆí˜¸ì™€ ë¹„ë°€ë²ˆí˜¸ í™•ì¸ë€ì˜ TEXTê°€ ë™ì¼í•œì§€ í™•ì¸í•œë‹¤.

ë§Œì•½ í‹€ë¦´ ê²½ìš° ë¸Œë¼ìš°ì €ì—ê²Œ ì—ëŸ¬ì½”ë“œë¥¼ ë„˜ê²¨ì£¼ë©° 'ì´ ê³„ì •ì •ë³´ë¥¼ ì €ì¥í•˜ì‹œê² ìŠµë‹ˆê¹Œ' ë¬¸êµ¬ë¥¼ ì¶œë ¥í•˜ì§€ ì•Šë„ë¡ í•´ì•¼í•œë‹¤.

ê·¸ë¦¬ê³  ê³„ì •ì„ ìƒì„±í•˜ëŠ” ê³¼ì •ì—ì„œ ì¤‘ë³µë˜ëŠ” emailì´ë‚˜ usernameì˜ ì €ì¥ì„ ëª¨ë¸ì˜ unique ì†ì„±ì— ì˜í•´ ì—ëŸ¬ê°€ ë§‰ì•„ì¤€ë‹¤. ì´ ì—ëŸ¬ë¥¼ ì²˜ë¦¬í•´ì£¼ì–´ì•¼ í•œë‹¤.

ë§ˆì§€ë§‰ìœ¼ë¡œ ë¹„ë°€ë²ˆí˜¸ê°€ DBì— ê·¸ëŒ€ë¡œ ì €ì¥ë  ê²½ìš° ë³´ì•ˆì— ë§¤ìš° ì·¨ì•½í•´ì§€ë¯€ë¡œ í•´ì‹œí™”í•˜ì—¬ ì €ì¥í•œë‹¤.



ì£¼ì„ê³¼ í•¨ê»˜ ì½”ë“œë¥¼ ì‚´í”¼ë©° ì²œì²œíˆ ë‚˜ì•„ê°€ ë³´ë„ë¡ í•˜ì.

```js
export const postJoin = async (req, res) => {
  
  	// ì‚¬ìš©ìê°€ ì…ë ¥í•œ Formì—ì„œ ë°ì´í„°ë¥¼ ë°›ì•„ì˜¨ë‹¤.
    const { name, username, email, password, password2, location } = req.body;
    const pageTitle = "Join";
  
  	// ë¹„ë°€ë²ˆí˜¸ í™•ì¸ ì‹¤íŒ¨ì‹œ error status code 400 ë°˜í™˜í•˜ë©° í˜ì´ì§€ ë Œë”ë§
    if (password !== password2) {
        return res.status(400).render("join", {
            pageTitle,
            errorMessage: "Passwords do not match.",
        });
    }
  
		// ì‚¬ìš©ìê°€ ì…ë ¥í•œ ê³„ì •ì˜ ì´ë¦„ê³¼ ì´ë©”ì¼ì´ ì¤‘ë³µë˜ì—ˆëŠ”ì§€ í™•ì¸í•˜ê³  ê´€ë ¨ ì—ëŸ¬ ì²˜ë¦¬
    const exists = await User.exists({ $or: [{ username }, { email }] });
    if (exists) {
        return res.status(400).render("join", {
            pageTitle,
            errorMessage: "This username/email is already taken.",
        });
    }
  
  	// ì‚¬ìš©ì ê³„ì •ì„ ìƒì„±í•˜ì—¬ DBì— ì €ì¥, ì˜ˆìƒì¹˜ ëª»í•œ ì˜ˆì™¸ ë°œìƒì‹œ ì²˜ë¦¬
    try {
        await User.create({
            name,
            username,
            email,
            password,
            location,
        });
        return res.redirect("/login");
    } catch (error) {
        return res.status(400).render("join", {
            pageTitle: "Upload Video",
            errorMessage: error._message,
        });
    }
};
```



#### Status Code

ê³„ì •ì„ ë§Œë“¤ë©´ ì•„ë˜ì™€ ê°™ì€ ì°½ì´ ëœ¬ë‹¤.

<img width="462" alt="image" src="https://github.com/forwarder1121/forwarder1121.github.io/assets/66872094/c985e3cc-7075-4442-bbe9-33a46d84967f">

ì´ê²ƒì´ ëœ¨ëŠ” ì´ìœ ëŠ” ë¸Œë¼ìš°ì €ê°€ 200ë²ˆ status codeë¥¼ ë°›ì•„ ë¡œê·¸ì¸ì— ì„±ê³µí•˜ì˜€ê³ , ë”°ë¼ì„œ ë°©ê¸ˆ ì…ë ¥í•œ ê³„ì •ì€ ì˜¬ë°”ë¥¸ ê³„ì •ì´ë¼ íŒë‹¨í•˜ì—¬ ì´ ê³„ì •ì€ ìë™ì™„ì„±ì— ë“±ë¡í• êº¼ëƒ ë¬¼ì–´ë³´ëŠ” ê±°ë‹¤.

ê·¸ëŸ¬ë‚˜ ë§Œì¼ ì‚¬ìš©ìê°€ ì˜ëª»ëœ ê³„ì •ì„ ì§‘ì–´ë„£ì–´ ë¡œê·¸ì¸ì— ì‹¤íŒ¨í•˜ì˜€ëŠ”ë°ë„ ì´ ì°½ì´ ëœ¨ëŠ”ë°, ì´ê²ƒì€ 400ë²ˆ status codeë¥¼ ê¸°ì¬í•˜ì§€ ì•Šì•„ ê¸°ë³¸ê°’ì¸ 200ë²ˆ ì½”ë“œë¡œ ë¸Œë¼ìš°ì €ê°€ ì¸ì‹í•˜ì—¬ ë¸Œë¼ìš°ì €ëŠ” ì—¬ì „íˆ ê³„ì •ì´ ì˜¬ë°”ë¥´ë‹¤ íŒë‹¨í•˜ê¸° ë•Œë¬¸. ë”°ë¼ì„œ ë¡œê·¸ì¸ ì‹¤íŒ¨ì‹œ ìœ„ì˜ ì½”ë“œì—ì„œ ì²˜ëŸ¼ 400ë²ˆ status codeë¥¼ ê¸°ì¬í•˜ì—¬ ì˜¤ë¥˜ê°€ ìˆëŠ” ê³„ì •, ìë™ì™„ì„±ì— ë“±ë¡í•  ê°€ì¹˜ê°€ ì—†ëŠ” ê³„ì •ì„ì„ ë¸Œë¼ìš°ì €ê°€ ì•Œ ìˆ˜ ìˆë„ë¡ í•˜ì˜€ë‹¤.

<img width="680" alt="image" src="https://github.com/forwarder1121/forwarder1121.github.io/assets/66872094/90eb8c3b-8439-4d9a-8413-69d9c3d55a0c">

[MDN : Status Code](https://developer.mozilla.org/en-US/docs/Web/HTTP/Status)



#### Hash

ë¹„ë°€ë²ˆí˜¸ë¥¼ ì•„ë¬´ëŸ° ì•”í˜¸í™” ì—†ì´ DBì— ì§‘ì–´ë„£ì—ˆë‹¤ë©´, ë§Œì¼ íšŒì‚¬ DBê°€ í•´í‚¹ë‹¹í•˜ê²Œ ë˜ë©´ ê·¸ëŒ€ë¡œ íšŒì›ì •ë³´ë“¤ì„ í•´ì»¤ì˜ ì†ì— ë„˜ì–´ê°€ê²Œ ëœë‹¤.

ë”°ë¼ì„œ ìš°ë¦¬ëŠ” ë¹„ë°€ë²ˆí˜¸ë¥¼ ì•”í˜¸í™”ì˜ ì¼ì¢…ì¸ í•´ì‹œí•¨ìˆ˜ë¥¼ ì´ìš©í•˜ì—¬ DBì— ì €ì¥í•  ê²ƒì´ë‹¤.

ë¨¼ì € ì§€ê¸ˆ DBì˜ ìƒíƒœë¥¼ ë³´ì.

```js
> mongosh
> show dbs
> use <myDBName>
> show collections
> db.users.find() // usersì˜ ëª¨ë“  ë°ì´í„° ì¶œë ¥
> db.users.remove({}) // usersì˜ ëª¨ë“  ë°ì´í„° ì‚­ì œ
```

<img width="421" alt="image" src="https://github.com/forwarder1121/forwarder1121.github.io/assets/66872094/dc660a65-aa93-4e31-abc3-067654d70dfe">

ì´ë ‡ê²Œ ë‚´ê°€ ë¹„ë²ˆì„ "hello"ë¡œ ì„¤ì •í•œê²Œ ê·¸ëŒ€ë¡œ ë‹¤ ë³´ì—¬ë²„ë¦°ë‹¤. ë³´ì•ˆì— ë§¤ìš° ì·¨ì•½í•˜ë‹¤. 

ìš°ë¦¬ëŠ” ë¹„ë²ˆì„ ê·¸ëŒ€ë¡œ ì €ì¥í•˜ì§€ ì•Šìœ¼ë©´ì„œ, ì¶”í›„ ì‚¬ìš©ìê°€ ì…ë ¥í•œ ë¹„ë²ˆì´ ë§ëŠ”ì§€ í™•ì¸í•´ì•¼ í•œë‹¤. ê·¸ë¦¬ê³  ì´ëŠ” í•´ì‰¬í•¨ìˆ˜ë¥¼ ì´ìš©í•´ì„œ ê°€ëŠ¥í•˜ë‹¤.



í•´ì‰¬í•¨ìˆ˜ëŠ” ì„ì˜ì˜ ë°ì´í„°ë¥¼ ì¼ì • ê¸¸ì´ì˜ ë¹„íŠ¸ì—´ë¡œ ë³€í™˜í•˜ëŠ” ë‹¨ë°©í–¥ í•¨ìˆ˜ì´ë©´ì„œ determinstic í•¨ìˆ˜ì´ë‹¤.

ë‹¨ë°©í–¥ í•¨ìˆ˜ì´ê¸° ë•Œë¬¸ì— outputì—ì„œ inputì„ ëŒì–´ë‚¼ ìˆ˜ ì—†ë‹¤.

determinstic í•¨ìˆ˜ì´ê¸° ë•Œë¬¸ì— ë™ì¼ inputì—ì„œ í•­ìƒ ë™ì¼ outputì´ ë‚˜ì˜¨ë‹¤.



[í•´ì‰¬ í•¨ìˆ˜ì— ëŒ€í•œ ê¸€](https://www.codestates.com/blog/content/%EB%B8%94%EB%A1%9D%EC%B2%B4%EC%9D%B8-%ED%95%B4%EC%8B%9C%ED%95%A8%EC%88%98)



ë¹„ë°€ë²ˆí˜¸ ì €ì¥ì— í•´ì‹œí•¨ìˆ˜ë¥¼ ì ìš©í•˜ê¸° ìœ„í•´ bcryptë¼ëŠ” ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì´ìš©í•œë‹¤.

[npm : bcrypt](https://www.npmjs.com/package/bcrypt)

```js
> npm i bcrypt // bcrypt ì„¤ì¹˜
```



> ## Usage
>
> ### async (recommended)
>
> ```js
> const bcrypt = require('bcrypt');
> const saltRounds = 10;
> const myPlaintextPassword = 's0/\/\P4$$w0rD';
> const someOtherPlaintextPassword = 'not_bacon';
> ```
>
> #### To hash a password:
>
> Technique 1 (generate a salt and hash on separate function calls):
>
> ```js
> bcrypt.genSalt(saltRounds, function(err, salt) {
>     bcrypt.hash(myPlaintextPassword, salt, function(err, hash) {
>         // Store hash in your password DB.
>     });
> });
> ```
>
> Technique 2 (auto-gen a salt and hash):
>
> ```js
> bcrypt.hash(myPlaintextPassword, saltRounds, function(err, hash) {
>     // Store hash in your password DB.
> });
> ```
>
> Note that both techniques achieve the same end-result.
>
> #### To check a password:
>
> ```js
> // Load hash from your password DB.
> bcrypt.compare(myPlaintextPassword, hash, function(err, result) {
>     // result == true
> });
> bcrypt.compare(someOtherPlaintextPassword, hash, function(err, result) {
>     // result == false
> });
> ```



í•´ì‹œì˜ ì–´ì›ì€ í•´ì‹œ ë¸Œë¼ìš´(ê³ ê¸°, ê°ìë¥¼ ì„ì–´ ì¡°ë¦¬í•œ ê²ƒ)ì´ë‹¤.

ì¬ë£Œê°€ ê°™ë‹¤ë©´ í•´ì‹œ ë¸Œë¼ìš´ì€ ê°™ì„ ê²ƒì´ë‹¤. ê·¸ë¦¬ê³  ì¢€ë” ë§›ì„ ë‚´ê¸° ìœ„í•´ ì†Œê¸ˆ(salt)ë¥¼ ë¿Œë¦´ ìˆ˜ ìˆë‹¤.

ì´ë•Œ **saltRoundëŠ” ë°”ë¡œ ê·¸ ì†Œê¸ˆì˜ ì—­í• , ì •í™•íˆëŠ” í•´ì‹œí™” í•˜ëŠ” íšŸìˆ˜**ë¥¼ ì˜ë¯¸í•œë‹¤.



ì´ì œ ìš°ë¦¬ì˜ ë¹„ë°€ë²ˆí˜¸ë¥¼ í•´ì‹œí™” í•˜ì—¬ ì €ì¥í•˜ì.

ì´ë•Œ ì»¨íŠ¸ë¡¤ëŸ¬ì—ì„œ ì•”í˜¸í™”ë¥¼ í•´ì£¼ì–´ë„ ë˜ì§€ë§Œ, ê·¸ëƒ¥ moongoseì˜ pre m/wë¥¼ ì´ìš©í•˜ì—¬ ë” ê¹”ë”í•˜ê²Œ ì½”ë“œë¥¼ ì‘ì„±í•˜ì.

```js
import mongoose from "mongoose";
import bcrypt from "bcrypt";

const userSchema = new mongoose.Schema({
    email: { type: String, required: true, unique: true },
    username: { type: String, required: true, unique: true },
    password: { type: String, required: true },
    name: { type: String, required: true },
    location: String,
});

userSchema.pre("save", async function (err, result) {
    console.log(`Users password : ${this.password}`);
    this.password = await bcrypt.hash(this.password, 5);
    console.log(`Hashed password : ${this.password}`);
});

const User = mongoose.model("User", userSchema);
export default User;
```



<img width="519" alt="image" src="https://github.com/forwarder1121/forwarder1121.github.io/assets/66872094/d844c1e3-9f80-4680-a60b-5569992388cf">

ê·¸ëŸ¬ë©´ ì´ì²˜ëŸ¼ ë¹„ë²ˆì´ í•´ì‹œí™” ëœê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆê³ 

<img width="611" alt="image" src="https://github.com/forwarder1121/forwarder1121.github.io/assets/66872094/61bd5202-79dd-4003-9e31-5b8cbafccfdf">

ì‹¤ì œ DBì—ë„ í•´ì‹œí™”ëœ ë¹„ë²ˆì´ ì €ì¥ëœ ê²ƒì„ ì•Œ ìˆ˜ ìˆë‹¤.

ì´ë¡œì¨ ìš°ë¦¬ëŠ” DBê°€ í„¸ë ¤ë„ ë¹„ë²ˆì´ ê·¸ëŒ€ë¡œ ë…¸ì¶œë˜ì§€ ì•ŠëŠ” DBë¥¼ ê°€ì§€ê²Œ ë˜ì—ˆë‹¤!



#### $or êµ¬ë¬¸

ìš°ë¦¬ëŠ” ì‚¬ìš©ìê°€ ë§Œë“œë ¤ëŠ” ê³„ì •ì´ DBì— emailê³¼ usernameì´ ì¡´ì¬í•˜ì§€ ì•ŠëŠ”ì§€ orì—°ì‚°ìœ¼ë¡œ ì¡°ì‚¬í•´ì•¼í•œë‹¤.

ê·¸ë¦¬ê³  ì´ë•Œ, mongoDBì˜ or êµ¬ë¬¸ì„ í™œìš©í•œë‹¤.

> # $or[![img](https://www.mongodb.com/docs/manual/assets/link.svg)](https://www.mongodb.com/docs/manual/reference/operator/query/or/#-or)
>
> - `$or`[![img](https://www.mongodb.com/docs/manual/assets/link.svg)](https://www.mongodb.com/docs/manual/reference/operator/query/or/#mongodb-query-op.-or)
>
>   The [`$or`](https://www.mongodb.com/docs/manual/reference/operator/query/or/#mongodb-query-op.-or) operator performs a logical `OR` operation on an array of *one or more* `<expressions>` and selects the documents that satisfy *at least* one of the `<expressions>`.
>
> ## Compatibility[![img](https://www.mongodb.com/docs/manual/assets/link.svg)](https://www.mongodb.com/docs/manual/reference/operator/query/or/#compatibility)
>
> You can use `$or` for deployments hosted in the following environments:
>
> - [MongoDB Atlas](https://www.mongodb.com/docs/atlas?tck=docs_server): The fully managed service for MongoDB deployments in the cloud
>
> - [MongoDB Enterprise](https://www.mongodb.com/docs/manual/administration/install-enterprise/#std-label-install-mdb-enterprise): The subscription-based, self-managed version of MongoDB
> - [MongoDB Community](https://www.mongodb.com/docs/manual/administration/install-community/#std-label-install-mdb-community-edition): The source-available, free-to-use, and self-managed version of MongoDB
>
> ## Syntax[![img](https://www.mongodb.com/docs/manual/assets/link.svg)](https://www.mongodb.com/docs/manual/reference/operator/query/or/#syntax)
>
> The [`$or`](https://www.mongodb.com/docs/manual/reference/operator/query/or/#mongodb-query-op.-or) operator has the following syntax:
>
> ```
> { $or: [ { <expression1> }, { <expression2> }, ... , { <expressionN> } ] }
> ```
>
> Consider the following example:
>
> ```
> db.inventory.find( { $or: [ { quantity: { $lt: 20 } }, { price: 10 } ] } )
> ```
>
> This query will select all documents in the `inventory` collection where either the `quantity` field value is less than `20` **or** the `price` field value equals `10`.



---

## 

## Login



ì´ì œ ìš°ë¦¬ëŠ” íšŒì›ê°€ì…ì„ í†µí•´ DBì— íšŒì›ì •ë³´ë¥¼ ê°€ì§€ê³  ìˆê¸° ë•Œë¬¸ì—, ì´ë¥¼ ë°”íƒ•ìœ¼ë¡œ ë¡œê·¸ì¸ì„ êµ¬í˜„í•  ìˆ˜ ìˆë‹¤.

ë¡œê·¸ì¸ êµ¬í˜„ ìˆœì„œëŠ” ì•„ë˜ì™€ ê°™ë‹¤.

1. Form ì œì‘
2. Routing ì²˜ë¦¬
3. Controller ì²˜ë¦¬



### Making Form & Routing

```pug
extends base

block content
    if errorMessage
        span=errorMessage

    form(method="POST")
        input(placeholder="Username" name="username",type="text",required)
        input(placeholder="Password" name="password",type="password",required)
        input(type="submit",value="Login")
    hr
    div 
        span Don't have an account?  
        a(href="/join") Create one now &rarr;
```

Joinê³¼ ë¹„ìŠ·í•˜ê²Œ login ë²„íŠ¼ì„ ëˆ„ë¥´ë©´ ê°™ì€ URLì—ì„œ POST ìš”ì²­ì„ ë³´ë‚¸ë‹¤.

ì´ POST ìš”ì²­ì„ ë°›ëŠ” ë¼ìš°íŒ… ì²˜ë¦¬ë¥¼ í•´ì£¼ì.

```js
rootRouter.route("/login").get(getLogin).post(postLogin);
```



### Contorlling

```js
export const postLogin = async (req, res) => {
    const { username, password } = req.body;
    const pageTitle = "Login";
    //check if account exists
    const user = await User.findOne({ username });
    if (!user) {
        return res.status(404).render("login", {
            pageTitle,
            errorMessage: "An account with this username does not exists.",
        });
    }

    //check if password correct
    const checkPassword = await bcrypt.compare(password, user.password);
    if (!checkPassword) {
        return res.status(404).render("login", {
            pageTitle,
            errorMessage: "Wrong password",
        });
    }
   
    return res.redirect("/");
};
```



### Hash : check password 



í•´ì‰¬í•¨ìˆ˜ëŠ” ë™ì¼ inputì— ëŒ€í•´ í•­ìƒ ê°™ì€ outputì„ ë‚´ë†“ëŠ” ê²ƒì„ ì´ìš©í•˜ì—¬ ì…ë ¥ëœ ë¹„ë²ˆì˜ í•´ì‹œê°’ì´ ìš°ë¦¬ DBì— ì €ì¥ëœ í•´ì‹œê°’ê³¼ ì¼ì¹˜í•˜ëŠ” ì§€ ë¹„êµí•œë‹¤.

ì´ê²ƒì€ **ì‹¤ì œ ë¹„ë²ˆì„ ëª°ë¼ë„ ì¼ì¹˜ì„±ì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤ëŠ” ê²ƒì„ ì˜ë¯¸**í•œë‹¤.

ë”°ë¼ì„œ ë³´ì•ˆ ì¸¡ë©´ì—ì„œ ìš°ìˆ˜í•˜ë‹¤.



> #### To check a password:
>
> ```js
> // Load hash from your password DB.
> bcrypt.compare(myPlaintextPassword, hash, function(err, result) {
>     // result == true
> });
> bcrypt.compare(someOtherPlaintextPassword, hash, function(err, result) {
>     // result == false
> });
> 
> async function checkUser(username, password) {
>     //... fetch user from a db etc.
> 
>     const match = await bcrypt.compare(password, user.passwordHash);
> 
>     if(match) {
>         //login
>     }
> 
>     //...
> }
> ```

bcryptëŠ” userê°€ ì…ë ¥í•œ textì¸ ì²« ì¸ìë¥¼ ìë™ìœ¼ë¡œ í•´ì‹œí™” í•¨ìˆ˜ì— ë„£ì–´ì„œ ë‘ë²ˆì§¸ ì¸ìì™€ ë¹„êµí•˜ê³ , Boolean ê°’ì„ ë°˜í™˜í•œë‹¤.

ê·¸ë¦¬ê³  **saltRound ê°’ì€ í•´ì‹œ ê°’ì—ì„œ êµ¬í•  ìˆ˜ ìˆìœ¼ë¯€ë¡œ, ìš°ë¦¬ëŠ” ë”°ë¡œ saltRoundê°’ì„ ì‹ ê²½ì“°ì§€ ì•Šì•„ë„ ëœë‹¤**.

![](https://i.stack.imgur.com/m8opZ.png)



ì°¸ê³ ë¡œ ìš°ë¦¬ê°€ ë¹„ë²ˆì„ ê¹Œë¨¹ì—ˆì„ë•Œ ì‚¬ì´íŠ¸ëŠ” ê·¸ ë¹„ë²ˆì„ ì•Œë ¤ì£¼ì§€ ì•Šì•˜ë˜ ì´ìœ ê°€ ì—¬ê¸°ì— ìˆë‹¤.

ì‚¬ì‹¤ ê·¸ ì‚¬ì´íŠ¸ëŠ” ìš°ë¦¬ì˜ ë¹„ë²ˆì„ ì•ˆ ì•Œë ¤ì¤€ê²Œ ì•„ë‹ˆë¼, ëª» ì•Œë ¤ì¤€ê²ƒì´ë‹¤.

ì™œëƒí•˜ë©° ìš°ë¦¬ì˜ ë¹„ë²ˆì„ í•´ì‹œí™”ë˜ì–´ ìˆì—ˆê¸° ë•Œë¬¸ì´ë‹¤.

ë§Œì¼ ê·¸ëŒ€ë¡œ ìš°ë¦¬ì˜ ë¹„ë²ˆì„ ì•Œë ¤ì£¼ëŠ” ì‚¬ì´íŠ¸ëŠ” ë°”ë¡œ ê±°ë¥´ë„ë¡í•˜ì. ìš°ë¦¬ì˜ ë¹„ë²ˆì´ DBì— ê·¸ëŒ€ë¡œ ë…¸ì¶œë˜ì–´ ìˆë‹¤ëŠ” ëœ»ì´ë‹ˆ.

